<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Codenames Board</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        background-color: #fffffc;
        padding: 20px;
      }
      .board-container {
        margin-top: 20px;
      }
      .board {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
        max-width: 500px;
        margin: auto;
      }
      .card {
        padding: 15px;
        background: #fffffc;
        border: 2px solid #ddd;
        cursor: pointer;
        transition: background 0.3s, transform 0.2s;
        text-transform: capitalize;
        font-weight: bold;
        border-radius: 8px;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
      }
      .card:hover {
        background: #e9ecef;
        transform: scale(1.05);
      }
      .card.selected {
        background: #cfbaf0;
        color: #4a4e69;
        border-color: #a694c4;
      }
      .incorrect {
        background: #d3d3d3;
        border-color: #b0b0b0;
      }
      .correct {
        background: #caffbf;
        border-color: #a6df9b;
      }
      .disabled {
        pointer-events: none;
      }
      button {
        margin-top: 20px;
        padding: 10px 20px;
        background-color: #98bbb2;
        color: black;
        font-weight: bold;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }
      button:hover {
        background-color: #7b958e;
      }

      .saveResults {
        display: flex;
        justify-content: flex-end;

        button {
          background-color: #91e3c7;
        }
      }
    </style>
  </head>
  <body>
    <h1>Codenames Board</h1>
    <label for="boardSelector">Choose a board:</label>
    <select id="boardSelector"></select>
    <div class="board-container">
      <div id="board" class="board"></div>
    </div>
    <button id="showResultsBtn">Show Results</button>
    <div class="saveResults">
      <button id="saveResultsBtn">Save Results as CSV</button>
    </div>

    <script>
      const WORD_SETS = [
        {
          words: ["ash", "future"],
          hints: ["Universe", "Immortality", "Possible", "Future"],
        },
        {
          words: ["water", "salad"],
          hints: ["Soup", "Pasta", "Lunch", "Veggies"],
        },
        {
          words: ["planets", "neptune"],
          hints: ["Jupiter", "Moons", "Solar System", "Planets"],
        },
        {
          words: ["hot", "wheel"],
          hints: ["Intense", "Brakes", "Speed", "Driving"],
        },
        {
          words: ["cannon", "genius"],
          hints: ["Furnace", "Kite", "Guns", "Battle"],
        },
        {
          words: ["magazine", "duel"],
          hints: ["Rival", "Editor", "Writer", "Battle"],
        },
        {
          words: ["farm", "potato"],
          hints: ["Butcher", "Agricultural", "Vegetable", "Harvest"],
        },
        {
          words: ["small", "rage"],
          hints: ["Frustration", "Emotion", "Anger", "Outburst"],
        },
        {
          words: ["king", "clown"],
          hints: ["Queen", "Crown", "Royalty", "Funny"],
        },
        {
          words: ["diamond", "junk"],
          hints: ["Gold", "Spaghetti", "Precious", "Treasure"],
        },
        {
          words: ["philippine", "vegas"],
          hints: ["Luzon", "Las Vegas", "Island", "Tourist"],
        },
        { words: ["cane", "turn"], hints: ["Drive", "Take", "Wheel", "Ride"] },
        {
          words: ["frankenstein", "application"],
          hints: ["Superhero", "Dracula", "Monster", "Zombie"],
        },
        {
          words: ["figure", "post"],
          hints: ["Fortress", "Stump", "Office", "Structure"],
        },
        {
          words: ["dress", "cinderella"],
          hints: ["Doll", "Attire", "Fashion", "Fairy Tale"],
        },
        {
          words: ["sun", "solar"],
          hints: ["Dome", "Photovoltaic", "Energy", "Light"],
        },
        {
          words: ["ocean", "sea"],
          hints: ["Underwater", "Waters", "Aquatic", "Marine"],
        },
        {
          words: ["mountain", "peak"],
          hints: ["Volcano", "Slopes", "Climbing", "Nature"],
        },
        {
          words: ["computer", "processor"],
          hints: ["Laptop", "Software", "Technology", "Coding"],
        },
        {
          words: ["artist", "painting"],
          hints: ["Designer", "Sculpture", "Art", "Creativity"],
        },
      ];

      function shuffleArray(array) {
        return array.sort(() => Math.random() - 0.5);
      }

      const shuffledSets = shuffleArray(WORD_SETS);
      const FIXED_WORDS = Object.fromEntries(
        shuffledSets.map((set, index) => [index + 1, set.words])
      );

      const BOARD_COUNT = 20;
      const boardSelector = document.getElementById("boardSelector");
      const boardElement = document.getElementById("board");
      const showResultsBtn = document.getElementById("showResultsBtn");
      let boardStates = {};

      for (let i = 1; i <= BOARD_COUNT; i++) {
        let option = document.createElement("option");
        option.value = i;
        option.textContent = `Board ${i}`;
        boardSelector.appendChild(option);
      }

      async function fetchWords() {
        const response = await fetch("../words.txt");
        const text = await response.text();
        return text
          .split("\n")
          .map((word) => word.trim())
          .filter((word) => word);
      }

      async function generateBoard() {
        const boardNumber = parseInt(boardSelector.value);

        if (!boardStates[boardNumber]) {
          const words = await fetchWords();
          if (words.length < 23) {
            alert("Not enough words in words.txt");
            return;
          }

          const shuffledWords = shuffleArray(words);
          const correctWords = FIXED_WORDS[boardNumber];
          const selectedWords = shuffledWords.slice(0, 23).concat(correctWords);
          selectedWords.sort(() => Math.random() - 0.5);

          boardStates[boardNumber] = {
            selectedCards: [],
            gameEnded: false,
            words: selectedWords,
          };
        }

        const { selectedCards, gameEnded, words } = boardStates[boardNumber];

        boardElement.innerHTML = "";

        words.forEach((word) => {
          const card = document.createElement("div");
          card.className = "card";
          card.textContent = word;
          card.dataset.correct = FIXED_WORDS[boardNumber].includes(word)
            ? "true"
            : "false";

          if (selectedCards.includes(word)) {
            card.classList.add("selected");
          }

          if (gameEnded) {
            card.classList.remove("selected");
            card.classList.add(card.dataset.correct === "true" && "correct");
          }

          card.addEventListener("click", () => selectCard(card, boardNumber));
          boardElement.appendChild(card);
        });

        boardElement.classList.toggle("disabled", gameEnded);
        showResultsBtn.disabled = gameEnded;
      }

      function selectCard(card, boardNumber) {
        if (boardStates[boardNumber].gameEnded) return;

        if (card.classList.contains("selected")) {
          card.classList.remove("selected");
          boardStates[boardNumber].selectedCards = boardStates[
            boardNumber
          ].selectedCards.filter((c) => c !== card.textContent);
        } else if (boardStates[boardNumber].selectedCards.length < 2) {
          card.classList.add("selected");
          boardStates[boardNumber].selectedCards.push(card.textContent);
        }
      }

      function showResults() {
        const boardNumber = parseInt(boardSelector.value);
        boardStates[boardNumber].gameEnded = true;

        document.querySelectorAll(".card").forEach((card) => {
          card.classList.remove("selected");
          card.classList.add(card.dataset.correct === "true" && "correct");
        });

        boardElement.classList.add("disabled");
        showResultsBtn.disabled = true;
      }

      function saveResultsToCSV() {
        const boardNumber = parseInt(boardSelector.value);
        let csvContent = "Word,Is Correct\n";

        document.querySelectorAll(".card").forEach((card) => {
          const word = card.textContent;
          const isCorrect =
            boardStates[boardNumber].selectedCards.includes(word) &&
            card.dataset.correct === "true"
              ? "True"
              : "False";

          csvContent += `${word},${isCorrect}\n`;
        });

        const blob = new Blob([csvContent], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `board_${boardNumber}_results.csv`;
        link.click();
        URL.revokeObjectURL(url);
      }

      document
        .getElementById("showResultsBtn")
        .addEventListener("click", () => {
          const selectedOption =
            boardSelector.options[boardSelector.selectedIndex];
          selectedOption.style.backgroundColor = "#d3d3d3";
        });

      showResultsBtn.addEventListener("click", showResults);
      boardSelector.addEventListener("change", generateBoard);
      document
        .getElementById("saveResultsBtn")
        .addEventListener("click", saveResultsToCSV);
      generateBoard();
    </script>
  </body>
</html>
